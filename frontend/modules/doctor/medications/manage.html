<!DOCTYPE html>
<html lang="en" class="dashboard-page doctor-dashboard">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Medications - Medical RAG</title>
    <link rel="stylesheet" href="/frontend/base.css">
    <link rel="stylesheet" href="/frontend/modules/doctor/dashboard.css">
    <link rel="stylesheet" href="manage.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="dashboard-page doctor-dashboard">
    <div id="navigation"></div>

    <!-- Doctor-specific navigation -->
    <nav class="doctor-nav">
        <a href="/frontend/modules/doctor/dashboard.html" class="nav-link">
            <i class="fas fa-home"></i> Dashboard
        </a>
        <a href="/frontend/modules/doctor/patients/manage.html" class="nav-link">
            <i class="fas fa-users"></i> Patients
        </a>
        <a href="/frontend/modules/doctor/appointments/manage.html" class="nav-link">
            <i class="fas fa-calendar-check"></i> Appointments
        </a>
        <a href="/frontend/modules/doctor/medications/manage.html" class="nav-link active">
            <i class="fas fa-pills"></i> Medications
        </a>
        <a href="/frontend/modules/doctor/screening/screening.html" class="nav-link">
            <i class="fas fa-search-medical"></i> Screening
        </a>
        <a href="/frontend/modules/doctor/analytics/analytics.html" class="nav-link">
            <i class="fas fa-chart-bar"></i> Analytics
        </a>
        <div class="nav-spacer"></div>
        <div class="user-menu">
            <button class="user-btn" id="user-menu-btn">
                <i class="fas fa-user-md"></i>
                <span id="user-name">Loading...</span>
                <i class="fas fa-chevron-down"></i>
            </button>
            <div class="user-dropdown hidden" id="user-dropdown">
                <a href="/frontend/modules/doctor/profile/profile.html"><i class="fas fa-user"></i> Profile</a>
                <a href="/frontend/modules/doctor/settings.html"><i class="fas fa-cog"></i> Settings</a>
                <div class="dropdown-divider"></div>
                <a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1><i class="fas fa-pills"></i> Prescribe Medications</h1>
            <p>Create and manage prescriptions and recommendations for patients</p>
        </div>

        <div class="content-grid">
            <!-- Left: Patient selector + list -->
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">Patient Medications</h3>
                    <div class="header-actions">
                        <select id="patient-select" class="form-control" style="min-width: 240px;">
                            <option value="">Select a patient...</option>
                        </select>
                        <label style="display:flex; align-items:center; gap:8px; color: var(--muted); font-size: 13px;">
                            <input id="active-only" type="checkbox" checked />
                            Active only
                        </label>
                        <button id="refresh-btn" class="btn btn-secondary">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="meds-loading" class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Loading...
                    </div>
                    <div id="meds-empty" class="hidden">
                        <div class="empty-state">
                            <i class="fas fa-pills"></i>
                            <h3>No medications</h3>
                            <p>Select a patient and prescribe medications.</p>
                        </div>
                    </div>
                    <div id="meds-content" class="hidden">
                        <div id="meds-list"></div>
                    </div>
                </div>
            </div>

            <!-- Right: Prescribe form -->
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">New Prescription</h3>
                </div>
                <div class="card-body">
                    <form id="prescribe-form">
                        <div class="form-group">
                            <label for="med-name">Medication Name</label>
                            <input id="med-name" class="form-control" placeholder="e.g., Amoxicillin" required />
                        </div>
                        <div class="form-group">
                            <label for="med-dosage">Dosage</label>
                            <input id="med-dosage" class="form-control" placeholder="e.g., 500mg" required />
                        </div>
                        <div class="form-group">
                            <label for="med-frequency">Frequency</label>
                            <input id="med-frequency" class="form-control" placeholder="e.g., Twice daily" required />
                        </div>
                        <div class="form-group">
                            <label for="med-start-date">Start Date</label>
                            <input id="med-start-date" type="date" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="med-end-date">End Date (optional)</label>
                            <input id="med-end-date" type="date" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="med-notes">Recommendations / Notes</label>
                            <textarea id="med-notes" class="form-control" rows="4"
                                placeholder="e.g., Take after meals, drink plenty of water, avoid alcohol"></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-prescription-bottle-medical"></i> Prescribe
                            </button>
                        </div>
                        <div id="form-hint" class="hint">
                            Select a patient on the left to enable prescribing.
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="/frontend/shared/api.js"></script>
    <script src="/frontend/shared/utils.js"></script>
    <script src="/frontend/auth/auth.js"></script>
    <script src="manage.js"></script>
    <script>
        // Load shared navigation
        fetch('/frontend/shared/nav.html')
            .then(r => r.text())
            .then(html => document.getElementById('navigation').innerHTML = html)
            .catch(console.error);

        document.addEventListener('DOMContentLoaded', function () {
            const auth = AuthApp.checkAuth();
            if (!auth || auth.user.role !== 'doctor') {
                window.location.href = '/frontend/auth/login.html';
                return;
            }

            document.getElementById('user-name').textContent = auth.user.full_name || auth.user.username;

            document.getElementById('logout-btn')?.addEventListener('click', (e) => {
                e.preventDefault();
                AuthApp.logout();
            });

            document.getElementById('user-menu-btn')?.addEventListener('click', (e) => {
                e.stopPropagation();
                document.getElementById('user-dropdown').classList.toggle('hidden');
            });

            window.doctorMedsApp?.init();
        });
    </script>
</body>

</html>

